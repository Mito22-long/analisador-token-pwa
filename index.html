
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pr√©-venda - MitoToken</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>üöÄ Pr√©-venda MitoToken</h1>
      <div class="phases">
        <span class="active">Fase 1 - $0.05</span>
        <span>Fase 2 - $0.07</span>
        <span>Fase 3 - $0.10</span>
      </div>

      <button class="wallet-btn" onclick="conectarCarteira()">üîê Conectar Carteira</button>
      <p id="carteira" class="info-text"></p>

      <label for="bnbValue">Valor em BNB</label>
      <input type="number" id="bnbValue" placeholder="0.1" />
      <button class="buy-btn" onclick="comprarPresale()">üí∏ Comprar Token</button>

      <p id="estimativa" class="info-text"></p>
      <p id="statusCompra" class="info-text"></p>
    </div>
  </div>

<script>
  let conta;
  const PRESALE_CONTRACT = "0xB8B6a2EDACcb795E4408D794cFB21dd8e8343824";
  const TOKEN_PRICE_USD = 0.05; // fase 1
  const ABI = [{ "inputs": [], "name": "buyTokens", "outputs": [], "stateMutability": "payable", "type": "function" }];

  async function conectarCarteira() {
    if (typeof window.ethereum !== 'undefined') {
      try {
        const contas = await ethereum.request({ method: 'eth_requestAccounts' });
        conta = contas[0];
        document.getElementById("carteira").innerText = "Carteira conectada: " + conta;
      } catch (e) {
        alert("Erro ao conectar.");
      }
    } else {
      alert("MetaMask n√£o detectado.");
    }
  }

  async function comprarPresale() {
    const valor = document.getElementById("bnbValue").value;
    const status = document.getElementById("statusCompra");

    if (!valor || parseFloat(valor) <= 0) {
      status.innerText = "‚ùó Informe um valor v√°lido em BNB";
      return;
    }

    try {
      const web3 = new Web3(window.ethereum);
      const contrato = new web3.eth.Contract(ABI, PRESALE_CONTRACT);
      status.innerText = "‚è≥ Enviando transa√ß√£o...";

      await contrato.methods.buyTokens().send({
        from: conta,
        value: web3.utils.toWei(valor, "ether")
      });

      status.innerText = "‚úÖ Compra realizada com sucesso!";
    } catch (e) {
      console.error(e);
      status.innerText = "‚ùå Erro na transa√ß√£o.";
    }
  }

  document.getElementById("bnbValue").addEventListener("input", async function () {
    const valorBNB = parseFloat(this.value);
    const estimativa = document.getElementById("estimativa");

    if (isNaN(valorBNB) || valorBNB <= 0) {
      estimativa.innerText = "";
      return;
    }

    try {
      const res = await fetch("https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT");
      const data = await res.json();
      const bnbUsd = parseFloat(data.price);
      const totalUSD = valorBNB * bnbUsd;
      const tokensRecebidos = Math.floor(totalUSD / TOKEN_PRICE_USD);

      estimativa.innerText = `üí° Voc√™ receber√° aproximadamente ${tokensRecebidos.toLocaleString()} tokens`;
    } catch (e) {
      estimativa.innerText = "Erro ao calcular estimativa.";
    }
  });
</script>
</body>
</html>
